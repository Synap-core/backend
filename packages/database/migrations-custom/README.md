# Custom SQL Migrations

This directory contains **manually written** SQL migrations for PostgreSQL features that cannot be auto-generated by Drizzle Kit.

## When to Use Custom Migrations

Use custom migrations for:

1. **PostgreSQL Extensions**
   ```sql
   CREATE EXTENSION IF NOT EXISTS vector;
   CREATE EXTENSION IF NOT EXISTS timescaledb;
   ```

2. **PL/pgSQL Functions**
   ```sql
   CREATE OR REPLACE FUNCTION my_function()
   RETURNS TABLE(...) AS $$
   BEGIN
     -- Complex logic
   END;
   $$ LANGUAGE plpgsql;
   ```

3. **TimescaleDB Hypertables**
   ```sql
   SELECT create_hypertable('events', 'timestamp');
   ```

4. **Complex Data Migrations**
   ```sql
   UPDATE users SET role = 'admin' WHERE email IN (...);
   ```

5. **Indexes with Special Options**
   ```sql
   CREATE INDEX CONCURRENTLY idx_embeddings ON entities 
   USING ivfflat (embedding vector_cosine_ops);
   ```

## Naming Convention

```
XXXX_description.sql
```

- `XXXX`: Sequential number (0001, 0002, etc.)
- `description`: Snake_case description

Examples:
- `0001_enable_extensions.sql`
- `0002_create_hypertables.sql`
- `0010_api_keys_functions.sql`

## How Migrations are Applied

1. **Drizzle migrations** (`../migrations-drizzle/`) are applied first
2. **Custom migrations** (this directory) are applied second
3. Both are tracked in the `_migrations` table

See `../src/migrate.ts` for the migration script.

