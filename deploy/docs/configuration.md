# Configuration Reference

Complete reference for all Synap Backend configuration options.

## Environment Variables

### Required Variables

#### `DOMAIN`

**Description**: Your domain name  
**Example**: `synap.example.com`  
**Required**: Yes

#### `LETSENCRYPT_EMAIL`

**Description**: Email for SSL certificate notifications  
**Example**: `admin@example.com`  
**Required**: Yes

#### `OPENAI_API_KEY`

**Description**: OpenAI API key for AI features  
**Example**: `sk-proj-...`  
**Required**: Yes  
**Get it**: https://platform.openai.com/api-keys

### Optional AI Providers

#### `ANTHROPIC_API_KEY`

**Description**: Anthropic Claude API key  
**Example**: `sk-ant-...`  
**Required**: No  
**Get it**: https://console.anthropic.com

#### `GOOGLE_AI_API_KEY`

**Description**: Google AI (Gemini) API key  
**Example**: `AIza...`  
**Required**: No  
**Get it**: https://makersuite.google.com/app/apikey

### Auto-Generated Secrets

These are automatically generated by the installer. Only change if you know what you're doing.

#### `POSTGRES_PASSWORD`

**Description**: PostgreSQL database password  
**Generated**: `openssl rand -base64 32`

#### `JWT_SECRET`

**Description**: JWT signing secret  
**Generated**: `openssl rand -base64 64`

#### `KRATOS_SECRETS_COOKIE`

**Description**: Ory Kratos cookie secret  
**Generated**: `openssl rand -base64 32`

#### `KRATOS_SECRETS_CIPHER`

**Description**: Ory Kratos cipher secret  
**Generated**: `openssl rand -base64 32`

#### `MINIO_SECRET_KEY`

**Description**: MinIO storage secret key  
**Generated**: `openssl rand -base64 32`

#### `TYPESENSE_API_KEY`

**Description**: Typesense search API key  
**Generated**: `openssl rand -base64 32`

#### `INTELLIGENCE_API_KEY`

**Description**: Intelligence service API key  
**Generated**: `openssl rand -base64 32`

### Advanced Configuration

#### `DEBUG`

**Description**: Enable debug logging  
**Default**: `false`  
**Values**: `true` | `false`

#### `MAX_UPLOAD_SIZE`

**Description**: Maximum file upload size  
**Default**: `100MB`  
**Example**: `500MB`, `1GB`

#### `DB_POOL_SIZE`

**Description**: Database connection pool size  
**Default**: `10`  
**Range**: `5-50`

#### `REDIS_MAX_MEMORY`

**Description**: Redis maximum memory  
**Default**: `256mb`  
**Example**: `512mb`, `1gb`

## Docker Compose Configuration

### Service Scaling

Scale services for higher load:

```yaml
# docker-compose.override.yml
services:
  backend:
    deploy:
      replicas: 3
```

### Resource Limits

Set resource limits:

```yaml
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 2G
        reservations:
          cpus: "1"
          memory: 1G
```

### Custom Ports

Change exposed ports:

```yaml
services:
  caddy:
    ports:
      - "8080:80"
      - "8443:443"
```

## Caddy Configuration

### Custom Domain Routing

Edit `Caddyfile` for custom routing:

```caddyfile
# Multiple domains
synap.example.com, api.example.com {
    reverse_proxy backend:4000
}

# Subdomain routing
app.synap.example.com {
    reverse_proxy frontend:3000
}
```

### Custom Headers

Add custom headers:

```caddyfile
{$DOMAIN} {
    header {
        # Your custom headers
        X-Custom-Header "value"
    }
}
```

## Database Configuration

### Connection Pooling

Adjust pool size in `.env`:

```env
DB_POOL_SIZE=20
```

### Backup Schedule

Configure automated backups:

```bash
# Add to crontab
0 2 * * * cd /opt/synap && ./synap-cli backup
```

### Performance Tuning

For high-traffic instances, tune PostgreSQL:

```yaml
# docker-compose.override.yml
services:
  postgres:
    command: >
      postgres
      -c max_connections=200
      -c shared_buffers=256MB
      -c effective_cache_size=1GB
```

## Storage Configuration

### MinIO

Access MinIO console:

```
https://your-domain.com/storage
```

Default credentials:

- Username: `minioadmin`
- Password: Value of `MINIO_SECRET_KEY`

### External Storage

Use S3-compatible storage:

```env
STORAGE_PROVIDER=s3
S3_ENDPOINT=https://s3.amazonaws.com
S3_REGION=us-east-1
S3_ACCESS_KEY=your-access-key
S3_SECRET_KEY=your-secret-key
S3_BUCKET=synap-storage
```

## Search Configuration

### Typesense

Adjust search settings:

```yaml
services:
  typesense:
    command: >
      --data-dir /data
      --api-key=${TYPESENSE_API_KEY}
      --enable-cors
      --log-level=info
```

## Monitoring

### Enable Metrics

Add Prometheus metrics:

```yaml
services:
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
```

### Log Aggregation

Use Loki for log aggregation:

```yaml
services:
  loki:
    image: grafana/loki
    ports:
      - "3100:3100"
```

## Security

### Firewall Rules

Configure UFW:

```bash
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

### SSL Configuration

Force HTTPS redirect (already configured in Caddyfile):

```caddyfile
{$DOMAIN} {
    # Automatic HTTPS redirect
}
```

### Rate Limiting

Add rate limiting in Caddy:

```caddyfile
{$DOMAIN} {
    rate_limit {
        zone dynamic {
            key {remote_host}
            events 100
            window 1m
        }
    }
}
```

## Troubleshooting

### View Configuration

```bash
# View current .env
cat .env

# View Docker Compose config
docker compose config
```

### Test Configuration

```bash
# Validate docker-compose.yml
docker compose config --quiet

# Check service health
./synap-cli health
```

### Reset Configuration

```bash
# Stop services
docker compose down

# Reset .env from template
cp .env.example .env

# Edit and restart
nano .env
docker compose up -d
```

## Best Practices

1. **Never commit `.env` to git**
2. **Backup `.env` securely**
3. **Use strong, unique secrets**
4. **Rotate secrets periodically**
5. **Monitor resource usage**
6. **Keep Docker images updated**
7. **Test configuration changes in staging first**

## Next Steps

- [Backup & Restore](./backups.md)
- [Monitoring](./monitoring.md)
- [Scaling](./scaling.md)
